####mysql存储引擎

下面重点介绍几种常用的存储引擎,并对比各个存储引擎之间的区别，以帮助读者理解 不同存储引擎的使用方式。     

表 7-1 常用存储引擎的对比

| 特点           | MyISAM | InnoDB | MEMORY | MERGE | NDB  |
| -------------- | ------ | ------ | ------ | ----- | ---- |
| 存储限制       | 有     | 64TB   | 有     | 没有  | 有   |
| 事务安全       |        | 支持   |        |       |      |
| 锁机制         | 表锁   | 行锁   | 表锁   | 表锁  | 行锁 |
| B 树索引       | 支持   | 支持   | 支持   | 支持  | 支持 |
| 哈希索引       |        |        | 支持   |       | 支持 |
| 全文索引       | 支持   |        |        |       |      |
| 集群索引       |        | 支持   |        |       |      |
| 数据缓存       |        | 支持   | 支持   |       | 支持 |
| 索引缓存       | 支持   | 支持   | 支持   | 支持  | 支持 |
| 数据可压缩     | 支持   |        |        |       |      |
| 空间使用       | 低     | 高     | N/A    | 低    | 低   |
| 内存使用       | 低     | 高     | 中等   | 低    | 高   |
| 批量插入的速度 | 高     | 低     | 高     | 高    | 高   |
| 支持外键       |        | 支持   |        |       |      |

 

1，MyISAM 

 MyISAM 是 MySQL 的默认存储引擎。MyISAM 不支持事务、也不支持外键，其优势是访 问的速度快，对事务完整性没有要求或者以 SELECT、INSERT 为主的应用基本上都可以使用 这个引擎来创建表。 每个 MyISAM 在磁盘上存储成 3 个文件，其文件名都和表名相同，但扩展名分别是： 

 .frm（存储表定义）； 

 .MYD（MYData，存储数据）；

  .MYI （MYIndex，存储索引）。 数据文件和索引文件可以放置在不同的目录，平均分布 IO，获得更快的速度。    

要指定索引文件和数据文件的路径，需要在创建表的时候通过 DATA DIRECTORY 和 INDEX DIRECTORY 语句指定，也就是说不同 MyISAM 表的索引文件和数据文件可以放置到不同的路 径下。文件路径需要是绝对路径，并且具有访问权限。 MyISAM 类型的表可能会损坏，原因可能是多种多样的，损坏后的表可能不能访问，会 提示需要修复或者访问后返回错误的结果。MyISAM 类型的表提供修复的工具，可以用 CHECK TABLE 语句来检查 MyISAM 表的健康，并用 REPAIR TABLE 语句修复一个损坏的 MyISAM 表。 表损坏可能导致数据库异常重新启动，需要尽快修复并尽可能地确认损坏的原因。具体的操 作步骤可以参见第 35 章应急处理。 MyISAM 的表又支持 3 种不同的存储格式，分别是：  静态（固定长度）表；  动态表；  压缩表。 其中，静态表是默认的存储格式。静态表中的字段都是非变长字段，这样每个记录都是 固定长度的，这种存储方式的优点是存储非常迅速，容易缓存，出现故障容易恢复；缺点是 占用的空间通常比动态表多。静态表的数据在存储的时候会按照列的宽度定义补足空格，但 是在应用访问的时候并不会得到这些空格，这些空格在返回给应用之前已经去掉    

2,InnoDB    

InnoDB 存储引擎提供了具有提交、回滚和崩溃恢复能力的事务安全。但是对比 MyISAM 的存储引擎，InnoDB 写的处理效率差一些并且会占用更多的磁盘空间以保留数据和索引。 下面将重点介绍 InnoDB 存储引擎的表使用过程中不同于其他存储引擎的特点。    

​	1、自动增长列    

InnoDB 表的自动增长列可以手工插入，但是插入的值如果是空或者 0，则实际插入的将 是自动增长后的值。下面定义新表 autoincre_demo，其中列 i 使用自动增长列，对该表插入 记录，然后查看自动增长列的处理情况，可以发现插入 0 或者空实际插入的都将是自动增长 后的值   ,

\可以通过“ALTER TABLE *** AUTO_INCREMENT = n;”语句强制设置自动增长列的初识值， 默认从 1 开始，但是该强制的默认值是保留在内存中的，如果该值在使用之前数据库重新启 动，那么这个强制的默认值就会丢失，就需要在数据库启动以后重新设置    

​	2、外键约束     

MySQL 支持外键的存储引擎只有 InnoDB，在创建外键的时候，要求父表必须有对应的 索引，子表在创建外键的时候也会自动创建对应的索引。    

​	3、存储方式 

InnoDB 存储表和索引有以下两种方式。

  使用共享表空间存储，这种方式创建的表的表结构保存在.frm 文件中，数据和索引 保存在 innodb_data_home_dir 和 innodb_data_file_path 定义的表空间中，可以是 多个文件。

  使用多表空间存储，这种方式创建的表的表结构仍然保存在.frm 文件中，但是每个 表的数据和索引单独保存在.ibd 中。如果是个分区表，则每个分区对应单独的.ibd 文件，文件名是“表名+分区名”，可以在创建分区的时候指定每个分区的数据文件 的位置，以此来将表的 IO 均匀分布在多个磁盘上。

要使用多表空间的存储方式，需要设置参数 innodb_file_per_table，并重新启动服务后 才可以生效，对于新建的表按照多表空间的方式创建，已有的表仍然使用共享表空间存储。 如果将已有的多表空间方式修改回共享表空间的方式，则新建表会在共享表空间中创建，但 已有的多表空间的表仍然保存原来的访问方式。所以多表空间的参数生效后，只对新建的表 生效。 多表空间的数据文件没有大小限制，不需要设置初始大小，也不需要设置文件的最大限 制、扩展大小等参数。 对于使用多表空间特性的表，可以比较方便地进行单表备份和恢复操作，但是直接复 制.ibd 文件是不行的，因为没有共享表空间的数据字典信息，直接复制的.ibd 文件和.frm 文 件恢复时是不能被正确识别的，但可以通过以下命令： ALTER TABLE tbl_name DISCARD TABLESPACE; ALTER TABLE tbl_name IMPORT TABLESPACE; 将备份恢复到数据库中，但是这样的单表备份，只能恢复到表原来在的数据库中，而不 Linux公社 www.linuxidc.com 117 能恢复到其他的数据库中。如果要将单表恢复到目标数据库，则需要通过 mysqldump 和 mysqlimport 来实现。    